<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Segments</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
        h1 { color: #333; }
        .segment { margin: 1rem 0; }
        #time-info { background: #f5f5f5; padding: 1rem; border-radius: 4px; margin: 1rem 0; }
    </style>
</head>
<body>
    <h1>Audio Segment Player</h1>

    <div id="time-info">
        <p>Clock offset: <span id="clock-offset">-</span> ms</p>
        <p>Audio output latency: <span id="output-latency">-</span> ms</p>
        <button onclick="synchronize()">Synchronize</button>
    </div>

    <iframe id="player-frame" style="display:none;"></iframe>

    <script>
        let clockOffset = 0;

        let outputLatency = 0;

        window.addEventListener('message', (event) => {
            if (event.data.type === 'clockCalibrated') {
                clockOffset = event.data.offset;
                outputLatency = event.data.outputLatency;
                document.getElementById('clock-offset').textContent = clockOffset.toFixed(2);
                document.getElementById('output-latency').textContent = outputLatency.toFixed(2);
            }
        });

        function getServerTime() {
            return Date.now() + clockOffset;
        }

        function synchronize() {
            document.getElementById('clock-offset').textContent = '-';
            document.getElementById('output-latency').textContent = '-';
            document.getElementById('player-frame').src = '/player';
        }
    </script>
</body>
</html>
